services:
  mailhog:
    image: mailhog/mailhog:latest
    container_name: invoicing-mailhog
    restart: unless-stopped
    ports:
      - "1025:1025"   # SMTP
      - "8025:8025"   # Web UI - open http://localhost:8025

  # The app service is optional - use it only when you want to run
  # everything inside Docker. For IDE development, just run:
  #   docker compose up mailhog
  # Then start the app from your IDE.
  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: invoicing-app
    restart: unless-stopped
    profiles:
      - full    # only starts with: docker compose --profile full up
    ports:
      - "8080:8080"
    depends_on:
      mailhog:
        condition: service_started
    env_file:
      - .env
    environment:
      SPRING_MAIL_HOST: mailhog
      SPRING_MAIL_PORT: 1025
      SPRING_MAIL_USERNAME: ""
      SPRING_MAIL_PASSWORD: ""
    healthcheck:
      test: ["CMD", "wget", "--spider", "-q", "http://localhost:8080/actuator/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s


